# yaml-language-server: $schema=https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/schema.json

#
# ⚠️
# `oh-my-posh enable reload` to make changes take effect immeadiately, or `rm -rf ~/.cache/oh-my-posh` after each save.
# `oh-my-posh disable reload` when finished making changes, to speed things up.
#


#
# Docs
#
# https://ohmyposh.dev/docs/
# https://www.nerdfonts.com/cheat-sheet
# https://quickref.me/yaml
#


#
# TODO
#
# high priority
  # add spaces in various places
  # better colors, see below
  # bubbles theme - this is an interesting idea, maybe play around w/ it. minimal on the left, info on the right. need to use ble.sh for rprompt to work though?
  # !!! `oh-my-posh disable reload` when done to speed things up

# low priority
  # the background colors of the diamonds etc fade differently than the main segments when they're dimmed b/c they're not the active pane in iterm
  # show git-scm icon if not github or gitlab remote
  # font uninstall 3270 - how? theres no unsinstall command
  # compare to default theme for any config you might want. check a few others too
    # console_title_template: '{{ .Shell }} in {{ .Folder }}'
    # folder_separator_icon: '  '
    # branch_template: '{{ trunc 25 .Branch }}'
  # add more vertical padding around text
    # can't do through oh-my-posh, need to do in iterm. there's a vertical padding setting, but it doesn't affecct leading/trailing diamonds
  # make the order of attributes consistent, like alphabetical or from most fundamental to least



version: 3
final_space: true

palette:
    # test these out
    # m365princess the light and dark blues from
    # cert - red/green/blue
    # chips - path yellow
    # cinnamon - user@host green/blue
    # cloudnativeazure - checkmark
    # dracula - runner blue '#6272a4'
    # nu4a lightgrey
    # powerline path blue
    # rudolpsdask green and blue
    # takula shellblue
    # stelbent blue and green
    # thecyberden green

    # Active colors
    white: '#FFFFFF'
      # need another foreground color to go with things like sky_blue that are lighter.
      # check other themes. something like an off-white?
    blue: '#33658A'
    sky_blue: '#86BBD8'
    green_blue: '#047E84'

    grey: '#3B4252'
    dark_grey: '#1C1F26'
    dark_red: '#491515'

    #green: '#98C379'
    #green: '#7FC9A6'
    #green: '#6A9955'
    #green: '#4B7043'
    #green: '#3F6B3A'
    green: '#2F5230'


    #purple: '#9D7CD8'
    #purple: '#6A4C93'
    #purple: '#4E4B8B'
    #purple: '#8a62da'
    #purple: '#83769c'
    purple: '#5F4B8B'

    # Unused colors
    # Leaveing because it took awhile to pick them and might want them later.
    red_orange: '#CC3802'
    black: '#000000'

    salmon: '#FCA17D'
    peach: '#FFB066'
    brown: '#7c553b'

    #yellow: '#FFB066'
    #yellow: '#FFFF8D'
    #yellow: '#FFF64F'
    #yellow: '#FFC400'

upgrade:
    source: cdn
    interval: 168h
    auto: false
    notice: false

blocks:
    # New line before every prompt, to improve readability
    - type: prompt
      alignment: left
      force: true
      segments:
        - template: '{{ printf "\n\n" }}'
          type: session

    # Context
    # Colors should go from darkest to lightest, to create a visual hierarchy.
    - type: prompt
      alignment: left
      segments:
        # Shell / username
        - style: diamond
          leading_diamond: ''
          template: '{{ if .Env.LOCALWP_SHELL }} {{ .Env.LOCALWP_SHELL }} {{ else }} {{ .HostName }} {{ end }}'
          foreground: p:white
          # TODO: Don't love the purple, but it's the best so far
          background_templates:
            - '{{ if .Env.LOCALWP_SHELL }}p:green{{ else }}p:purple{{ end }}'
          type: session

        # Path
        - properties:
            style: folder
          template: ' {{ .AbsolutePWD }} '
          powerline_symbol: ''
          foreground: p:white
          background: p:blue
          type: path
          style: powerline

    # Git
    # Colors should go from darkest to lightest, to create a visual hierarchy.
    # todo maybe wanna change colors now that its on a diff line. maybe 2nd line colors match top line?
    - type: prompt
      newline: true
      alignment: left
      segments:
        # Git branch
        - type: git
          style: diamond
          leading_diamond: ''
          foreground: p:white
          background: p:green_blue

          # TODO: the else isn't working to show the git icon when no remote. remotegone not working either
          # want to show the git icon if no remote, but not github/gitlab
          # it's showing the correct icon when on main branch, but then switches to fallback icon on new branch
          template: >-
            {{ if .Upstream }} {{ .UpstreamIcon }}{{ else }} 󰊢{{ end }}
            {{ printf " " }}{{ .HEAD }}{{ printf " " }}
          # .HEAD shows 'into foo' when detached, but maybe that's ok? seems weird though, should be "foo (merging master)" or something. foo is the current branch, master is what's being merged in
          #  {{ if .UpstreamGone }} 󰊢 this shows up when merge conflict not when no remote{{ end }}

          properties:
            fetch_status: true
            fetch_upstream_icon: true
            source: cli
            branch_icon: ''

        # Git status
        - type: git
          style: powerline
          powerline_symbol: ""
          foreground: p:dark_grey
          background: p:sky_blue

          # TODO pencil icon shows up even when no changes
          # TODO ≢ icon shows up when everything committed. maybe because not in sync w/ remote?
          # TODO up arrow icon not rhowing up when ahead of remote anymore
          # Showing things individually instead of .Working.String so can put spaces between them.
          template: >-
            {{ if .BranchStatus }} {{ .BranchStatus }}{{ end }}
            {{ if or (.Working.Changed) (.Staging.Changed) }} {{ end }}
            {{ .Working.String }}
            {{ if gt .StashCount 0 }} {{ end }}
          properties:
            fetch_status: true
            source: cli

        # Git problems
        - type: git
          style: powerline
          powerline_symbol: ""
          foreground: p:white
          background: p:dark_red

          # TODO: want to show if conflict resolved but still in merge state
          # TODO: add bisecting too, although maybe it should be in status b/c it's not necessarily a problem. maybe partially covered by .detached. add state of current bisect
          # TODO how to strip the extra spaces that come from the line breaks?
          # todo if reverting then show "reverting {hash}"
          template: >-
            {{ if .Detached }} detached{{ end }}
            {{ if .Merge }} merge conflict{{ end }}
            {{ if .CherryPick }} cherry-picking{{ end }}
            {{ if .Revert }} reverting{{ end }}
            {{ if .Rebase }} rebasing{{ end }}
          properties:
            fetch_status: true
            source: cli



    # SVN
    # todo maybe wanna change colors now that its on a diff line. maybe 2nd line colors match top line?
    # todo auto cleanup when slow, like old prompt did. not possible with omp? or need custom command or?
    # todo show whether repo is public or private? to help avoid accidentally commiting private to public. need an array of hostnames for each then some yaml logic.
    - type: prompt
      newline: true
      alignment: left
      segments:
        # SVN branch
        - type: svn
          style: diamond
          leading_diamond: ''
          foreground: p:white
          background: p:green_blue

          # can use status_formats to say "M" instead of "~" ?
          # todo not working
          # status_formats:
          #   - "Added": "Added: %d"

          # todo don't want the relative url, just the branch. this may be specific to how svn.w.org is setup
          template: >-
            {{ " " }} {{ " " }}{{.Branch}} {{ " " }}

        # SVN status
        - type: svn
          style: powerline
          powerline_symbol: ""
          foreground: p:dark_grey
          background: p:sky_blue
          template: >-
            {{ " " }}{{ .Working.String }}{{ " " }}
          properties:
            fetch_status: true

        # SVN problems
        # - type: svn
        #   style: powerline
        #   powerline_symbol: ""
        #   foreground: p:white
        #   background: p:dark_red

        #   # dunno why this isn't working - https://ohmyposh.dev/docs/segments/scm/svn#status
        #   template: >-
        #     {{ if and .HasConflicts (eq .HasConflicts true) }}hasconflicts{{ end }}
        #   #  {{ if .HasConflicts }} hasconflicts{{ end }}
        #   #  {{ " " }}problems{{ " " }}
        #   properties:
        #     fetch_status: true # can be false?

    # Prompt
    - type: prompt
      newline: true
      alignment: left
      segments:
        - template: ''
          foreground: p:blue
          type: text
          style: plain
