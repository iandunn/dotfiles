# yaml-language-server: $schema=https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/schema.json

#
# ⚠️
# `oh-my-posh enable reload` to make changes take effect immeadiately, or `rm -rf ~/.cache/oh-my-posh` after each save.
# `oh-my-posh disable reload` when finished making changes, to speed things up.
#


#
# Docs
#
# https://ohmyposh.dev/docs/installation/customize
# https://ohmyposh.dev/docs/configuration/general
# https://www.nerdfonts.com/cheat-sheet


#
# TODO
#
# high priority
  # parity w/ old prompt like git conflicts, bisecting, etc
  # add spaces in various places
  # better colors, see below
  # bubbles theme - this is an interesting idea, maybe play around w/ it. minimal on the left, info on the right
  # !!! `oh-my-posh disable reload` when done to speed things up

# low priority
  # the background colors of the diamonds etc fade differently than the main segments when they're dimmed b/c they're not the active pane in iterm
  # show git-scm icon if not github or gitlab remote
  # font uninstall 3270 - how? theres no unsinstall command
  # compare to default theme for any config you might want. check a few others too
    # console_title_template: '{{ .Shell }} in {{ .Folder }}'
    # folder_separator_icon: '  '
    # branch_template: '{{ trunc 25 .Branch }}'
  # add more vertical padding around text
    # can't do through oh-my-posh, need to do in iterm. there's a vertical padding setting, but it doesn't affecct leading/trailing diamonds
  # make the order of attributes consistent, like alphabetical or from most fundamental to least
  # svn status similar to git - need to write a custom feature or something? or just use `command`?


version: 3
final_space: true

palette:
    # test these out
    # m365princess the light and dark blues from
    # cert - red/green/blue
    # chips - path yellow
    # cinnamon - user@host green/blue
    # cloudnativeazure - checkmark
    # dracula - runner blue '#6272a4'
    # powerline path blue
    # rudolpsdask green and blue
    # takula shellblue
    # stelbent blue and green
    # thecyberden green

    white: '#FFFFFF'
    black: '#000000'
      # probably make this more like a dark grey
      # need another foreground color to go with things like sky_blue that are lighter. check other themes

    blue: '#33658A'
    sky_blue: '#86BBD8'
    red_orange: '#CC3802'
    green_blue: '#047E84'
    salmon: '#FCA17D'
    peach: '#FFB066'

    #yellow: '#FFB066'
    #yellow: '#FFFF8D'
    #yellow: '#FFF64F'
    #yellow: '#FFC400'

    # nu4a lightgrey

    #purple: '#9D7CD8'
    #purple: '#6A4C93'
    #purple: '#4E4B8B'
    #purple: '#8a62da'
    #purple: '#83769c'
    purple: '#5F4B8B'


    brown: '#7c553b'

    grey: '#3B4252'
    dark_grey: '#1C1F26'
    dark_red: '#491515'


    #green: '#98C379'
    #green: '#7FC9A6'
    #green: '#6A9955'
    #green: '#4B7043'
    #green: '#3F6B3A'
    green: '#2F5230'

upgrade:
    source: cdn
    interval: 168h
    auto: false
    notice: false

blocks:
    # New line before every prompt, to improve readability
    - type: text
      force: true
      newline: true

    # Context & State
    # Colors should go from darkest to lightest, to create a visual hierarchy.
    - type: prompt
      alignment: left
      segments:
        # Shell / username
        - style: diamond
          leading_diamond: ''
          template: '{{ if .Env.LOCALWP_SHELL }} {{ .Env.LOCALWP_SHELL }} {{else}} {{ .HostName }} {{ end }}'
          foreground: p:white
          # foreground_templates:
          #   - '{{ if .Env.LOCALWP_SHELL }}p:dark_grey{{else}}p:white{{ end }}'

          # TODO: Don't love the purple, but it's the best so far
          background_templates:
            - '{{ if .Env.LOCALWP_SHELL }}p:green{{else}}p:purple{{ end }}'
          type: session

        # Path
        - properties:
            style: folder
          template: ' {{ .AbsolutePWD }} '
          powerline_symbol: ''
          foreground: p:white
          background: p:blue
          type: path
          style: powerline

    # Git
    # Colors should go from darkest to lightest, to create a visual hierarchy.
    - type: prompt
      newline: true
      alignment: left
      segments:
        # Git branch
        - type: git
          style: diamond
          leading_diamond: ''

          #foreground_templates:
          #  - "{{ if or (.Working.Changed) (.Staging.Changed) }}p:dark_grey{{ else }}p:white{{ end }}"
          # if just doing branch name then don't need to change color
          #background_templates:
            # Not red/green because dirty is the normal state, it should feel calm, not harsh or bad.
            # Clean is the boring state, so it should feel neutral.
          #  - "{{ if or (.Working.Changed) (.Staging.Changed) }}p:sky_blue{{ else }}p:grey{{ end }}"

          foreground: p:white
          background: p:green_blue

          # TODO: the else isn't working to show the git icon when no remote. remotegone not working either
          # want to show the git icon if no remote, but not github/gitlab
          # it's showing the correct icon when on main branch, but then switches to fallback icon on new branch
          #
          # TODO: this seems like it's taking a lot more room than the old prompt. figure out why and maybe adjust.
          template: >-
            {{ if .Upstream }} {{ .UpstreamIcon }}{{ else }} 󰊢{{ end }}
            {{ printf " " }}{{ .HEAD }}{{ printf " " }}
          # .HEAD shows into foo when detached, but maybe that's ok
          #  {{ if .UpstreamGone }} 󰊢 this shows up when merge conflict not when no remote{{ end }}

          properties:
            fetch_status: true
            fetch_upstream_icon: true
            source: cli
            branch_icon: ''

        # Git status
        - type: git
          style: powerline
          powerline_symbol: ""
          foreground: p:dark_grey
          background: p:sky_blue

          # TODO pencil icon shows up even when no changes
          # TODO ≢ icon shows up when everything committed. maybe because not in sync w/ remote?
          # TODO up arrow icon not rhowing up when ahead of remote anymore
          # Showing things individually instead of .Working.String so can put spaces between them.
          template: >-
            {{ if .BranchStatus }} {{ .BranchStatus }}{{ end }}
            {{ if or (.Working.Changed) (.Staging.Changed) }} {{ end }}
            {{ .Working.String }}
            {{ if gt .StashCount 0 }} {{end}}
          properties:
            fetch_status: true
            fetch_upstream_icon: false
            source: cli

        # # Git status
        # - type: git
        #   style: powerline
        #   powerline_symbol: ''
        #   foreground: p:white
        #   background: p:green_blue

        #   # if just doing branch name then don't need to change color
        #   # foreground_templates:
        #   #  - "{{ if or (.Working.Changed) (.Staging.Changed) }}p:white{{ else }}p:white{{ end }}"

        #   # Not red/green because dirty is the normal state, it should feel calm, not harsh or bad.
        #   # Clean is the boring state, so it should feel neutral.
        #   # background_templates:
        #   #   - "{{ if or (.Working.Changed) (.Staging.Changed) }}p:green_blue{{ else }}p:grey{{ end }}"

        #   # want this to not show up at all if there's no stashes / changes / etc, rather than being grey
        #   template: >-
        #     {{ if .BranchStatus }} {{ .BranchStatus }}{{ end }}
        #     {{ .Working.String }}
        #     {{ if gt .StashCount 0 }} {{end}}{{ printf " " }}
        #     {{ if .Working.Changed }} {{end}}
        #   #  if merging 
        #   #  {{ if .Untracked.Count }} untracked {{ .Untracked.Count }} {{end}}
        #   #  {{ if .Untracked.Count }} untracked {{ .Untracked.Count }} {{end}}
        #   #  {{ if .Rebase }} {{(rebasing)}} {{end}}
        #   #  {{rebase_icon}} {{cherry_pick_icon}} {{merge_icon}}

        #   #{{ if .Rebasing }} {{end}}
        #   #{{rebase_icon}} {{cherry_pick_icon}} {{merge_icon}}
        #   # also show conflicts, rebasing, bisecting, etc. maybe also in orange
        #   #{{branch_ahead_icon}} x{{branch_behind_icon}}

        #   # {{ if .Working.Changed }}●{{end}}
        #   # {{ if .Staging.Changed }}●{{end}}
        #   # {{ if .Untracked.Count }}…{{end}}

        # Git problems
        - type: git
          style: powerline
          powerline_symbol: ""
          foreground: p:white
          background: p:dark_red

          # want to show if conflict resolved but still in merge state
          template: >-
            {{ if .Detached }} detached {{ end }}
            {{ if .Merge }} merge conflict {{ end }}
            {{ if .CherryPick }} cherry-picking {{ end }}
            {{ if .Revert }} reverting {{ end }}
            {{ if .Rebase }} rebasing {{ end }}
          properties:
            fetch_status: true
            fetch_upstream_icon: false
            source: cli

        # Third segment: only shows if problems
        # - type: git
        #   style: powerline
        #   powerline_symbol: ""
        #   foreground: p:white
        #   background: p:red_orange
        #   template: >-
        #     {{ if or (and .Unmerged (gt .Unmerged.Count 0)) (and .Rebasing (gt .Rebasing.Count 0)) }}
        #       merge conflicts
        #     {{ end }}
        #   properties:
        #     fetch_status: true
        #     fetch_upstream_icon: false
        #     source: cli

    # Prompt
    - type: prompt
      newline: true
      alignment: left
      segments:
        - template: ''
          foreground: p:blue
          type: text
          style: plain
