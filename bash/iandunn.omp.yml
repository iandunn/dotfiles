# yaml-language-server: $schema=https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/schema.json

#
# ⚠️
# `oh-my-posh enable reload` to make changes take effect immeadiately, or `rm -rf ~/.cache/oh-my-posh` after each save.
# `oh-my-posh disable reload` when finished making changes, to speed things up.
#


#
# Docs
#
# https://ohmyposh.dev/docs/
# https://quickref.me/yaml
# https://go-language.org/go-docs/text/template/
# https://masterminds.github.io/sprig/strings.html
# https://www.nerdfonts.com/cheat-sheet
#


#
# TODO
#
# high priority
  # !!! `oh-my-posh disable reload` when done to speed things up

# low priority
  # bubbles theme - this is an interesting idea, maybe play around w/ it. minimal on the left, info on the right. need to use ble.sh for rprompt to work though?
  # tweak colors more, see notes in `palette` section
  # show git-scm icon if not github or gitlab remote
  # font uninstall 3270 - how? theres no unsinstall command
  # compare to default theme for any config you might want. check a few others too
    # console_title_template: '{{ .Shell }} in {{ .Folder }}'
    # folder_separator_icon: '  '
    # branch_template: '{{ trunc 25 .Branch }}'
  # add more vertical padding around text
    # can't do through oh-my-posh, need to do in iterm. there's a vertical padding setting, but it doesn't affecct leading/trailing powerline symbols
  # make the order of attributes consistent, like alphabetical or from most fundamental to least

version: 3
final_space: true

upgrade:
    source: cdn
    interval: 168h
    auto: false
    notice: false

palette:
    # test these out
    # m365princess the light and dark blues from
    # cert - red/green/blue
    # chips - path yellow
    # cinnamon - user@host green/blue
    # cloudnativeazure - checkmark
    # dracula - runner blue '#6272a4'
    # nu4a lightgrey
    # powerline path blue
    # rudolpsdask green and blue
    # takula shellblue
    # stelbent blue and green
    # thecyberden green

    # Active colors
    white: '#FFFFFF'
      # need another foreground color to go with things like sky_blue that are lighter.
      # check other themes. something like an off-white?
    blue: '#33658A'
    sky_blue: '#86BBD8'
    green_blue: '#047E84'

    grey: '#3B4252'
    dark_grey: '#1C1F26'
    dark_red: '#491515'

    #green: '#98C379'
    #green: '#7FC9A6'
    #green: '#6A9955'
    #green: '#4B7043'
    #green: '#3F6B3A'
    green: '#2F5230'

    #purple: '#9D7CD8'
    #purple: '#6A4C93'
    #purple: '#4E4B8B'
    #purple: '#8a62da'
    #purple: '#83769c'
    purple: '#5F4B8B'

    # Unused colors
    # Leaveing because it took awhile to pick them and might want them later.
    red_orange: '#CC3802'
    black: '#000000'
    salmon: '#FCA17D'
    peach: '#FFB066'
    brown: '#7c553b'

    #yellow: '#FFB066'
    #yellow: '#FFFF8D'
    #yellow: '#FFF64F'
    #yellow: '#FFC400'

blocks:
    # New line before every prompt, to improve readability
    - type: prompt
      alignment: left
      force: true
      segments:
        - template: '{{ printf "\n\n" }}'
          type: session

    # Context
    # Colors should go from darkest to lightest, to create a visual hierarchy.
    - type: prompt
      alignment: left
      segments:
        # Hostname / LocalWP shell
        - style: powerline
          leading_powerline_symbol: ''
          template: '{{ if .Env.LOCALWP_SHELL }} {{ .Env.LOCALWP_SHELL }} {{ else }} {{ .HostName }} {{ end }}'
          foreground: p:white
          # TODO: Don't love the purple, but it's the best so far. Well, it's kind of growing on me.
          background_templates:
            - '{{ if .Env.LOCALWP_SHELL }}p:green{{ else }}p:purple{{ end }}'
          type: session

        # Path
        - properties:
            style: folder
          template: ' {{ .AbsolutePWD }} '
          powerline_symbol: ''
          foreground: p:white
          background: p:blue
          type: path
          style: powerline

    # Git
    # Colors should go from darkest to lightest, to create a visual hierarchy.
    # todo maybe wanna change colors now that its on a diff line. maybe 2nd line colors match top line?
    - type: prompt
      newline: true
      alignment: left
      segments:
        # Git branch
        - type: git
          style: powerline
          leading_powerline_symbol: ''
          foreground: p:white
          background: p:green_blue

          # TODO: the else isn't working to show the git icon when no remote. remotegone not working either
          # want to show the git icon if no remote, but not github/gitlab
          # it's showing the correct icon when on main branch, but then switches to fallback icon on new branch
          # TODO show SVN icon if it's a git-svn remote (so know to use dcommit etc). how to detect?
          template: >-
            {{ if .Upstream }} {{ .UpstreamIcon }}{{ else }} 󰊢{{ end }}
            {{ printf " " }}{{ .HEAD }}{{ printf " " }}
          #  {{ if .UpstreamGone }} 󰊢 this shows up when merge conflict not when no remote{{ end }}

          properties:
            fetch_upstream_icon: true
            source: cli
            branch_icon: ''

        # Git status
        - type: git
          style: powerline
          powerline_symbol: ''
          foreground: p:dark_grey
          background: p:sky_blue

          # TODO pencil icon shows up even when no changes
          # TODO ≢ icon shows up when everything committed. maybe because not in sync w/ remote? but there's already the up arrow for that.
          template: >-
            {{ if .BranchStatus }} {{ .BranchStatus }}{{ end }}
            {{ if or (.Working.Changed) (.Staging.Changed) }} {{ end }}
            {{ .Working.String }}
            {{ if gt .StashCount 0 }} {{ end }}
          properties:
            fetch_status: true
            source: cli

        # Git problems
        - type: git
          style: powerline
          powerline_symbol: ''
          foreground: p:white
          background: p:dark_red

          # TODO: want to show if conflict resolved but still in merge state
          # TODO: add bisecting too, although maybe it should be in status b/c it's not necessarily a problem. maybe partially covered by .detached. add state of current bisect
          # TODO how to strip the extra spaces that come from the line breaks?
          # todo if reverting then show "reverting {hash}"
          # todo how to show stash pop conflicts?
          # todo are there situations where this will show the error even if not in conflict, like in a merge state for some other reason?
          template: >-
            {{ if .Merge }} merge conflict{{ end }}
            {{ if .Detached }} detached{{ end }}
            {{ if .CherryPick }} cherry-picking conflict{{ end }}
            {{ if .Revert }} reverting conflict{{ end }}
            {{ if .Rebase }} rebasing conflict{{ end }}
          properties:
            fetch_status: true
            source: cli

    # SVN
    # todo maybe wanna change colors now that its on a diff line. maybe 2nd line colors match top line?
    # todo auto cleanup when slow, like old prompt did. not possible with omp? or need custom command? not high priority
    # todo show whether repo is public or private? to help avoid accidentally commiting private to public. need an array of hostnames for each then some yaml logic.
    - type: prompt
      newline: true
      alignment: left
      segments:
        # SVN branch
        - type: svn
          style: powerline
          leading_powerline_symbol: ''
          powerline_symbol: ''
          foreground: p:white
          background: p:green_blue

          # can use status_formats to say "M" instead of "~" ?
          # todo not working
          # status_formats:
          #   - "Added": "Added: %d"

          # Strip out the repository name, so only the branch is shown.
          # This works for plugins.svn.w.org, and core|meta.svn.w.org (as long as you check out the `trunk` branch and not its parent directory).
          # TODO: Can't indent the if/else or get unwanted line breaks
          template: >-
            {{ " " }}
            {{ if contains "/" .Branch }}
            {{ join "/" (slice (splitList "/" .Branch) 1) }}
            {{ else }}
            {{ .Branch }}
            {{ end }}

        # SVN status
        - type: svn
          style: powerline
          powerline_symbol: ''
          foreground: p:dark_grey
          background: p:sky_blue
          template: >-
            {{ " " }}{{ .Working.String }}{{ " " }}
          properties:
            fetch_status: true

        # SVN problems
        # - type: svn
        #   style: powerline
        #   powerline_symbol: ''
        #   foreground: p:white
        #   background: p:dark_red

        #   # this works, so the problem isn't somewhere else in the segment
        #   # template: ' hello '

        #   # this doesn't work
        #   template: '{{ if gt .Conflicted 0 }} svn has conflicts {{ end }}'

        #   properties:
        #     fetch_status: true # once this segment is working, see if it'll still work when this is false

    # Prompt
    - type: prompt
      newline: true
      alignment: left
      segments:
        - template: ''
          foreground: p:blue
          type: text
          style: plain
